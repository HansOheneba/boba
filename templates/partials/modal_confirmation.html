<div
  x-show="showModal"
  class="fixed z-50 inset-0 flex items-center justify-center bg-black bg-opacity-70 p-4 overflow-y-auto"
  x-transition:enter="transition ease-out duration-300"
  x-transition:enter-start="opacity-0 scale-90"
  x-transition:enter-end="opacity-100 scale-100"
  x-transition:leave="transition ease-in duration-300"
  x-transition:leave-start="opacity-100 scale-100"
  x-transition:leave-end="opacity-0 scale-90"
>
  <script>
    document.addEventListener(
      "DOMContentLoaded",
      () =>
        (document.getElementById("paid").checked = document.getElementById(
          "payment_method"
        ).value =
          "paid")
    );
  </script>
  <div
    class="bg-[#12091A] border border-gray-700 p-6 rounded-xl shadow-lg max-w-sm w-full max-h-[80vh] overflow-y-auto"
  >
    <h2 class="text-xl font-bold text-gray-300 text-center">
      Confirm Your Order
    </h2>
    <p class="text-center mt-4 text-gray-400 text-sm">
      Please review your order details below:
    </p>
    <div class="mt-4 text-sm space-y-2">
      <p class="flex justify-between text-gray-400">
        <strong class="text-gray-300">Name:</strong>
        <span
          class="bg-gray-800/20 px-2 py-1 rounded text-gray-300"
          x-text="name"
        ></span>
      </p>
      <p class="flex justify-between text-gray-400">
        <strong class="text-gray-300">Location:</strong>
        <span
          class="bg-gray-800/20 px-2 py-1 rounded text-gray-300"
          x-text="location"
        ></span>
      </p>
      <p class="flex justify-between text-gray-400">
        <strong class="text-gray-300">Phone:</strong>
        <span
          class="bg-gray-800/20 px-2 py-1 rounded text-gray-300"
          x-text="phone"
        ></span>
      </p>
      <p class="flex justify-between text-gray-400">
        <strong class="text-gray-300">Notes:</strong>
        <span
          class="bg-gray-800/20 px-2 py-1 rounded text-gray-300"
          x-text="preferences"
        ></span>
      </p>
      <p class="flex justify-between text-gray-400">
        <strong class="text-gray-300">Email:</strong>
        <span
          class="bg-gray-800/20 px-2 py-1 rounded text-gray-300"
          x-text="email"
        ></span>
      </p>
      <p class="flex justify-between text-gray-400 text-right">
        <strong class="text-gray-300">Order:</strong>
        <span
          id="order-summary"
          class="bg-gray-800/20 px-2 py-1 rounded text-gray-300"
        ></span>
      </p>
      <div class="flex justify-between text-gray-400">
        <strong class="text-gray-300">Total:</strong>
        <div class="flex items-center gap-2">
          <span
            class="bg-gray-800/20 px-2 py-1 rounded text-purple-400 font-semibold"
            x-text="total"
          ></span>
          GHS
        </div>
      </div>
      <div class="mt-4">
        <h2 class="text-lg font-semibold text-gray-300">Payment Method</h2>
        <ul class="grid w-full gap-4 md:grid-cols-2 mt-2">
          <!-- Pay Online (Paystack) Option (DEFAULT SELECTED) -->
          <li>
            <input
              type="radio"
              id="paid"
              name="payment_method"
              value="paid"
              class="hidden"
              checked
              onchange="updatePaymentMethod('paid')"
            />
            <label
              for="paid"
              class="flex items-center justify-between w-full p-4 text-gray-500 bg-white border border-gray-200 rounded-lg cursor-pointer dark:hover:text-gray-300 dark:border-gray-700 hover:text-gray-600 hover:bg-gray-100 dark:text-gray-400 dark:bg-gray-800 dark:hover:bg-gray-700"
            >
              <div class="flex items-center gap-2">
                <div
                  class="w-5 h-5 border border-gray-400 rounded flex items-center justify-center"
                >
                  <div
                    id="paid-checkbox"
                    class="w-3 h-3 rounded bg-transparent"
                  ></div>
                </div>
                <div>
                  <div class="text-sm font-semibold">Pay Online</div>
                  <div class="text-xs">Secure checkout with Paystack</div>
                </div>
              </div>
            </label>
          </li>

          <!-- Pay on Delivery Option -->
          <li>
            <input
              type="radio"
              id="on_delivery"
              name="payment_method"
              value="on_delivery"
              class="hidden"
              onchange="updatePaymentMethod('on_delivery')"
            />
            <label
              for="on_delivery"
              class="flex items-center justify-between w-full p-4 text-gray-500 bg-white border border-gray-200 rounded-lg cursor-pointer dark:hover:text-gray-300 dark:border-gray-700 hover:text-gray-600 hover:bg-gray-100 dark:text-gray-400 dark:bg-gray-800 dark:hover:bg-gray-700"
            >
              <div class="flex items-center gap-2">
                <div
                  class="w-5 h-5 border border-gray-400 rounded flex items-center justify-center"
                >
                  <div
                    id="on_delivery-checkbox"
                    class="w-3 h-3 rounded bg-transparent"
                  ></div>
                </div>
                <div>
                  <div class="text-sm font-semibold">Pay on Delivery</div>
                  <div class="text-xs">Cash upon arrival</div>
                </div>
              </div>
            </label>
          </li>
        </ul>

        <script>
          function updateCheckboxes() {
            document
              .getElementById("paid-checkbox")
              .classList.remove("bg-blue-500");
            document
              .getElementById("on_delivery-checkbox")
              .classList.remove("bg-blue-500");

            let selectedPayment = document.querySelector(
              'input[name="payment_method"]:checked'
            );
            if (selectedPayment) {
              document
                .getElementById(`${selectedPayment.id}-checkbox`)
                .classList.add("bg-blue-500");
            }
          }

          document.addEventListener("DOMContentLoaded", updateCheckboxes);
          document
            .querySelectorAll('input[name="payment_method"]')
            .forEach((input) => {
              input.addEventListener("change", updateCheckboxes);
            });
        </script>

        <!-- Hidden Input for Payment Method (Default: Paid) -->
        <input
          type="hidden"
          name="payment_method"
          id="payment_method"
          value="paid"
        />
      </div>
    </div>
    <div class="text-center mt-6">
      <button
        id="confirm-order-button"
        class="bg-purple-900 text-white p-3 rounded-lg w-full hover:bg-[#2B1A40] focus:ring-2 focus:outline-none focus:ring-purple-600 transition flex items-center justify-center gap-2"
        @click="disableButtonAndConfirm()"
        data-loader
      >
        <span class="button-text">Confirm</span>
        <span
          class="loader hidden animate-spin border-2 border-white border-t-transparent rounded-full w-4 h-4"
        ></span>
      </button>
      <button
        class="border-2 border-gray-500 text-white p-3 rounded-lg w-full mt-2 hover:bg-purple-800 hover:text-white focus:ring-2 focus:outline-none focus:ring-gray-600 transition"
        @click="showModal = false"
      >
        Edit
      </button>
    </div>
  </div>
</div>

<script>
  // Add this function to handle the button disabling and order confirmation
  function disableButtonAndConfirm() {
    const button = document.getElementById("confirm-order-button");

    // If button is already disabled, prevent double submission
    if (button.disabled) return;

    // Disable the button
    button.disabled = true;

    // Update visual appearance
    button.querySelector(".button-text").textContent = "Processing...";
    button.querySelector(".loader").classList.remove("hidden");

    // Call the original confirmation function
    handleOrderConfirmation();
  }
</script>
