<!DOCTYPE html>
<html lang="en" x-data="{ showModal: false, total: 0, orderNumber: '' }">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Order Boba & Shawarma</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/alpinejs@2.8.2/dist/alpine.min.js"
      defer
    ></script>
  </head>
  <body class="bg-gray-100">
    <div
      class="max-w-md mx-auto bg-white shadow-lg rounded-lg overflow-hidden mt-10"
    >
      <div class="p-4">
        <h1 class="text-xl font-bold text-center">Bubble Bliss</h1>
        <form action="/" method="POST" class="mt-4">
          <div class="mt-4">
            <h2 class="text-lg font-semibold">Boba Tea</h2>
            <div class="grid grid-cols-3 gap-4 mt-4">
              <button
                type="button"
                class="p-4 bg-pink-400 rounded-lg font-semibold"
                onclick="addToCart('Strawberry Boba', 4)"
              >
                Strawberry - 4 Cedis
              </button>
              <button
                type="button"
                class="p-4 bg-brown-400 rounded-lg font-semibold"
                onclick="addToCart('Chocolate Boba', 4)"
              >
                Chocolate - 4 Cedis
              </button>
              <button
                type="button"
                class="p-4 bg-yellow-400 rounded-lg font-semibold"
                onclick="addToCart('Vanilla Boba', 4)"
              >
                Vanilla - 4 Cedis
              </button>
            </div>
          </div>
          <div class="mt-4">
            <h2 class="text-lg font-semibold">Shawarma</h2>
            <div class="grid grid-cols-2 gap-4 mt-4">
              <button
                type="button"
                class="p-4 bg-gray-200 rounded-lg font-semibold"
                onclick="addToCart('Shawarma Regular', 5)"
              >
                Regular - 5 Cedis
              </button>
              <button
                type="button"
                class="p-4 bg-gray-300 rounded-lg font-semibold"
                onclick="addToCart('Shawarma Large', 7)"
              >
                Large - 7 Cedis
              </button>
            </div>
          </div>
          <div class="mt-4">
            <h2 class="text-lg font-semibold">Your Order</h2>
            <ul id="cart" class="list-disc pl-4 text-gray-700"></ul>
            <div id="total-container" class="mt-2 text-right font-bold hidden">
              Total: <span id="total">0</span> Cedis
            </div>
            <input type="hidden" name="order" id="order-input" />
            <input type="hidden" name="total" id="total-input" />
            <input
              type="text"
              name="name"
              placeholder="Enter your name"
              required
              class="w-full p-2 mt-2 border rounded"
            />
            <input
              type="text"
              name="location"
              placeholder="Enter your location"
              required
              class="w-full p-2 mt-2 border rounded"
            />
            <textarea
              name="notes"
              placeholder="Any special requests?"
              class="w-full p-2 mt-2 border rounded"
            ></textarea>
            <input
              type="text"
              name="phone"
              placeholder="Enter your phone number"
              required
              class="w-full p-2 mt-2 border rounded"
            />
            <button
              type="button"
              class="mt-4 w-full bg-blue-500 text-white p-2 rounded"
              @click="showModal = true; total = document.getElementById('total').textContent; orderNumber = generateOrderNumber()"
            >
              Place Order
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Confirmation Modal -->
    <div
      x-show="showModal"
      class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      x-transition:leave="transition ease-in duration-300"
      x-transition:leave-start="opacity-100"
      x-transition:leave-end="opacity-0"
    >
      <div class="bg-white p-6 rounded-lg shadow-lg max-w-sm w-full">
        <h2 class="text-xl font-bold text-center">Order Confirmation</h2>
        <p class="text-center mt-4">
          Thank you for your order! We will process it shortly.
        </p>
        <p class="text-center mt-4">
          Total Amount: <strong x-text="total">0</strong> Cedis
        </p>
        <p class="text-center mt-4">
          Order Number: <strong x-text="orderNumber"></strong>
        </p>
        <p class="text-center mt-4">
          Please make payment to mobile money number:
          <strong>0592076527</strong>
        </p>
        <p class="text-center mt-4">
          You will receive a call from us once payment has been made.
        </p>
        <p class="text-center mt-4 text-red-500">
          Note: Some extras will attract additional costs.
        </p>
        <div class="text-center mt-4">
          <button
            class="bg-blue-500 text-white p-2 rounded"
            @click="showModal = false; window.location.reload()"
          >
            Close
          </button>
        </div>
      </div>
    </div>

    <script>
      let cart = [];

      function addToCart(item, price) {
        let existingItem = cart.find((cartItem) => cartItem.name === item);
        if (existingItem) {
          existingItem.quantity += 1;
        } else {
          cart.push({ name: item, price: price, quantity: 1 });
        }
        updateCart();
      }

      function removeFromCart(index) {
        if (cart[index].quantity > 1) {
          cart[index].quantity -= 1;
        } else {
          cart.splice(index, 1);
        }
        updateCart();
      }

      function updateCart() {
        let cartList = document.getElementById("cart");
        cartList.innerHTML = "";
        let total = 0;
        cart.forEach((item, index) => {
          let li = document.createElement("li");
          li.textContent = `${item.name} x${item.quantity} - ${
            item.price * item.quantity
          } Cedis`;
          li.classList.add("cursor-pointer", "hover:text-red-500");
          li.onclick = () => removeFromCart(index);
          let removeButton = document.createElement("span");
          removeButton.textContent = " x";
          removeButton.classList.add("text-red-500", "cursor-pointer", "ml-2");
          removeButton.onclick = () => removeFromCart(index);
          li.appendChild(removeButton);
          cartList.appendChild(li);
          total += item.price * item.quantity;
        });
        document.getElementById("total").textContent = total;
        document.getElementById("total-input").value = total;
        document.getElementById("order-input").value = cart
          .map((item) => `${item.name} x${item.quantity}`)
          .join(", ");

        if (total > 0) {
          document.getElementById("total-container").classList.remove("hidden");
        } else {
          document.getElementById("total-container").classList.add("hidden");
        }

        // Update the total in the modal
        document.querySelector('[x-text="total"]').textContent = total;
      }

      function generateOrderNumber() {
        return Math.random().toString(36).substr(2, 8).toUpperCase();
      }
    </script>
  </body>
</html>
