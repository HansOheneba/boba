<!DOCTYPE html>
<html
  lang="en"
  x-data="{ showModal: false, total: 0, orderNumber: '', name: '', location: '', notes: '', phone: '' }"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Order Boba & Shawarma</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/alpinejs@2.8.2/dist/alpine.min.js"
      defer
    ></script>
  </head>
  <body class="bg-gray-100">
    <div
      class="max-w-md mx-auto bg-white shadow-lg rounded-lg overflow-hidden mt-10"
    >
      <div class="p-4">
        <h1 class="text-xl font-bold text-center">Bubble Bliss</h1>
        <form action="/" method="POST" class="mt-4" id="order-form">
          <div class="mt-4">
            <h2 class="text-lg font-semibold">Boba Tea</h2>
            <div class="grid grid-cols-3 gap-4 mt-4">
              <button
                type="button"
                class="p-4 bg-pink-400 rounded-lg font-semibold"
                onclick="addToCart('Strawberry Boba', 40)"
              >
                Strawberry
              </button>
              <button
                type="button"
                class="p-4 bg-brown-400 rounded-lg font-semibold"
                onclick="addToCart('Chocolate Boba', 40)"
              >
                Chocolate
              </button>
              <button
                type="button"
                class="p-4 bg-yellow-400 rounded-lg font-semibold"
                onclick="addToCart('Vanilla Boba', 40)"
              >
                Vanilla
              </button>
            </div>
          </div>
          <div class="mt-4">
            <h2 class="text-lg font-semibold">Shawarma</h2>
            <div class="grid grid-cols-2 gap-4 mt-4">
              <button
                type="button"
                class="p-4 bg-gray-200 rounded-lg font-semibold"
                onclick="addToCart('Shawarma Regular', 40)"
              >
                Regular
              </button>
              <button
                type="button"
                class="p-4 bg-gray-300 rounded-lg font-semibold"
                onclick="addToCart('Shawarma Large', 50)"
              >
                Large
              </button>
            </div>
          </div>
          <div class="mt-4">
            <h2 class="text-lg font-semibold">Your Order</h2>
            <ul id="cart" class="list-disc pl-4 text-gray-700"></ul>
            <div id="total-container" class="mt-2 text-right font-bold hidden">
              Total: <span id="total">0</span> GHS
            </div>
            <input type="hidden" name="order" id="order-input" />
            <input type="hidden" name="total" id="total-input" />
            <input
              type="text"
              name="name"
              placeholder="Enter your name"
              required
              class="w-full p-2 mt-2 border rounded"
              x-model="name"
            />
            <input
              type="text"
              name="location"
              placeholder="Enter your location"
              required
              class="w-full p-2 mt-2 border rounded"
              x-model="location"
            />
            <textarea
              name="notes"
              placeholder="Any special requests?"
              class="w-full p-2 mt-2 border rounded"
              x-model="notes"
            ></textarea>
            <input
              type="text"
              name="phone"
              placeholder="Enter your phone number"
              required
              class="w-full p-2 mt-2 border rounded"
              x-model="phone"
            />
            <button
              type="button"
              class="mt-4 w-full bg-blue-500 text-white p-2 rounded"
              @click="validateForm()"
            >
              Place Order
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Confirmation Modal -->
    <div
      x-show="showModal"
      class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      x-transition:leave="transition ease-in duration-300"
      x-transition:leave-start="opacity-100"
      x-transition:leave-end="opacity-0"
    >
      <div class="bg-white p-6 rounded-lg shadow-lg max-w-sm w-full">
        <h2 class="text-xl font-bold text-center">Confirm Your Order</h2>
        <p class="text-center mt-4 text-sm">
          Please review your order details below:
        </p>
        <div class="mt-4 text-sm">
          <p><strong>Name:</strong> <span x-text="name"></span></p>
          <p><strong>Location:</strong> <span x-text="location"></span></p>
          <p><strong>Phone:</strong> <span x-text="phone"></span></p>
          <p><strong>Notes:</strong> <span x-text="notes"></span></p>
          <p><strong>Order:</strong> <span id="order-summary"></span></p>
          <p><strong>Total:</strong> <span x-text="total"></span> GHS</p>
        </div>
        <div class="text-center mt-4">
          <button
            class="bg-green-500 text-white p-2 rounded w-full hover:bg-green-600 focus:ring-2 focus:outline-none focus:ring-green-300"
            @click="document.querySelector('form').submit()"
          >
            Confirm
          </button>
          <button
            class="border-2 border-red-500 text-red-500 p-2 rounded w-full mt-2 hover:bg-red-200 focus:ring-2 focus:outline-none focus:ring-red-300"
            @click="showModal = false"
          >
            Edit
          </button>
        </div>
      </div>
    </div>

    <script>
      let cart = [];

      function addToCart(item, price) {
        let existingItem = cart.find((cartItem) => cartItem.name === item);
        if (existingItem) {
          existingItem.quantity += 1;
        } else {
          cart.push({ name: item, price: price, quantity: 1 });
        }
        updateCart();
      }

      function removeFromCart(index) {
        if (cart[index].quantity > 1) {
          cart[index].quantity -= 1;
        } else {
          cart.splice(index, 1);
        }
        updateCart();
      }

      function updateCart() {
        let cartList = document.getElementById("cart");
        cartList.innerHTML = "";
        let total = 0;
        cart.forEach((item, index) => {
          let li = document.createElement("li");
          li.textContent = `${item.name} x${item.quantity} - ${
            item.price * item.quantity
          } GHS`;
          li.classList.add("cursor-pointer", "hover:text-red-500");
          li.onclick = () => removeFromCart(index);
          let removeButton = document.createElement("span");
          removeButton.textContent = " x";
          removeButton.classList.add("text-red-500", "cursor-pointer", "ml-2");
          removeButton.onclick = () => removeFromCart(index);
          li.appendChild(removeButton);
          cartList.appendChild(li);
          total += item.price * item.quantity;
        });
        document.getElementById("total").textContent = total;
        document.getElementById("total-input").value = total;
        document.getElementById("order-input").value = cart
          .map((item) => `${item.name} x${item.quantity}`)
          .join(", ");

        if (total > 0) {
          document.getElementById("total-container").classList.remove("hidden");
        } else {
          document.getElementById("total-container").classList.add("hidden");
        }

        // Update the order summary in the modal
        document.getElementById("order-summary").textContent = cart
          .map((item) => `${item.name} x${item.quantity}`)
          .join(", ");
      }

      function generateOrderNumber() {
        const chars = "abcdefghijklmnopqrstuvwxyz0123456789";
        let result = "boba-";
        for (let i = 0; i < 4; i++) {
          result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return result;
      }

      function validateForm() {
        const form = document.getElementById("order-form");
        if (form.checkValidity() && cart.length > 0) {
          document.querySelector("[x-data]").__x.$data.showModal = true;
          document.querySelector("[x-data]").__x.$data.total =
            document.getElementById("total").textContent;
          document.querySelector("[x-data]").__x.$data.orderNumber =
            generateOrderNumber();
        } else {
          form.reportValidity();
          if (cart.length === 0) {
            alert("Please select at least one item.");
          }
        }
      }
    </script>
  </body>
</html>
